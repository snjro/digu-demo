import{e as f,k}from"./CommonItemMember.CRanTEMj.js";import{u as y}from"./dbEventLogsDataHandlersSyncStatusUpdateDbItemSyncStatus.CbqpePuk.js";import{a as N}from"./dbBase.BEbG6e0G.js";import{a as S}from"./storeRpcSettings.CTg7fdRt.js";import"./storeSyncStatus.CLF-ij8b.js";function w(e){return new Worker(""+new URL("../workers/db.worker-BTghimlv.js",import.meta.url).href,{name:e==null?void 0:e.name})}async function A(e){return new Promise(a=>{const t=new w;t.addEventListener("message",n=>(t.terminate(),f.finished(n.data.log),a(n.data.value))),t.postMessage(e)})}const u=N.EventLog.syncStatus;async function g(e,a){return await e.transaction("r",u,async()=>await e.table(u).get(a))}async function P(e,a,t){return await e.transaction("r",u,async()=>(await e.table(u).toArray()).filter(s=>S(s[a],t)))}async function p(e,a,t){return(await g(e,a))[t]}function h(e,a,t){const s=Object.keys(t).map(o=>{const r=k(a,o);return e.table(r)});return s.push(e.table(N.EventLog.syncStatus)),s}async function R(e,a,t,n){const o=h(e,a.name,t).map(r=>r.name);await e.transaction("rw",o,async()=>{if(Object.keys(t).length>0){const r=[],m=await p(e,a.name,"events"),l=[];for(const c of Object.keys(t)){const i=k(a.name,c),b=t[c].length;r.push(e.table(i).bulkPut(t[c])),m[c].recordCount+=b,l.push({...e.versionIdentifier,contractName:a.name,eventName:c,tableName:i,numOfRecords:b})}await Promise.all(r),l.length&&f.success("BulkPut Event Logs.",l),await y(e,a.name,"events",m)}await y(e,a.name,"fetchedBlockNumber",n)})}async function W(e,a,t){let n=await e.table(a).toArray();return t&&(n=T(n,t)),n}function T(e,a){return e&&(a==="asc"?e.sort((t,n)=>t.blockNumber!==n.blockNumber?t.blockNumber-n.blockNumber:t.logIndex-n.logIndex):e.sort((t,n)=>n.blockNumber!==t.blockNumber?n.blockNumber-t.blockNumber:n.logIndex-t.logIndex)),e}export{g as a,P as b,R as c,W as g,A as s};
